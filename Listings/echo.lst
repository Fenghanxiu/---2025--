C51 COMPILER V9.60.0.0   ECHO                                                              04/05/2025 13:11:54 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE ECHO
OBJECT MODULE PLACED IN .\Objects\echo.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE echo.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\echo
                    -.lst) OBJECT(.\Objects\echo.obj)

line level    source

   1          #include "echo.h"
   2          
   3          sbit trig=P1^0;   //∂®“Â∑¢ÀÕ∂À
   4          sbit echo=P1^1;   //∂®“ÂΩ” ’∂À
   5          //PCAº∆ ±∞Ê±æ
   6          void Delay14us()                //@12.000MHz
   7          {
   8   1              unsigned char i;
   9   1      
  10   1              _nop_();
  11   1              _nop_();
  12   1              i = 39;
  13   1              while (--i);
  14   1      }
  15          
  16          void send_wave()
  17          {
  18   1              unsigned char i=0;
  19   1              EA=0;
  20   1              for(i=0;i<8;i++)
  21   1              {
  22   2                      trig=1;Delay14us();
  23   2                      trig=0;Delay14us();
  24   2              }
  25   1              EA=1;
  26   1      }
  27          unsigned int xdata distance=0;
  28          void Get_distance()
  29          {
  30   1              CMOD=0x00;
  31   1              CH=0;
  32   1              CL=0;
  33   1              send_wave();
  34   1              CR=1;
  35   1              while((CF==0)&&(echo==1));
  36   1              CR=0;
  37   1              if(!CF)
  38   1              {
  39   2                      distance=(unsigned int)(CH<<8|CL)*0.017;//cm
  40   2              }
  41   1              else
  42   1              {
  43   2                      CF=0;
  44   2                      distance=0;
  45   2              }
  46   1      }
  47          
  48          //PCA÷–∂œ
  49          
  50          void PCAInit()
  51          {
  52   1              CCON=0x00;
  53   1              CMOD=0x01;
  54   1              CCAPM0=0x11;
C51 COMPILER V9.60.0.0   ECHO                                                              04/05/2025 13:11:54 PAGE 2   

  55   1      }
  56          
  57          unsigned char xdata echo_flag=0;
  58          //unsigned int xdata distance=0;
  59          
  60          /* ultrasonic_flag ≥¨…˘≤®◊¥Ã¨±Í÷æ
  61                   0£∫ø’œ–Ω◊∂Œ
  62                   1£∫∑¢ÀÕΩ◊∂Œ
  63                   2£∫»∑»œΩ” ’µΩ∑µªÿµƒ≥¨…˘≤®
  64                   3£∫Ω” ’≤ªµΩ≥¨…˘≤®£¨ªÚ≥¨≥ˆ¡ø≥Ã */
  65          void TimerPCAIsr() interrupt 7
  66          {
  67   1              CR=0;
  68   1              
  69   1              if(echo_flag==1)//µ±¥¶”⁄∑¢ÀÕΩ◊∂Œ
  70   1              {
  71   2                      if(CCF0==1)/* Ω” ’µΩ∑µªÿµƒ≥¨…˘≤® */
  72   2                      {
  73   3                              echo_flag=2;//»∑»œΩ” ’µΩ∑µªÿµƒ≥¨…˘≤®
  74   3                      }
  75   2                      else if(CF==1)//Ω” ’≤ªµΩ≥¨…˘≤®£¨ªÚ≥¨≥ˆ¡ø≥Ã
  76   2                      {
  77   3                              echo_flag=3;//“‚Õ‚«Èøˆ
  78   3                      }
  79   2                      else
  80   2                      {
  81   3                              echo_flag=0;
  82   3                      }
  83   2              }
  84   1              
  85   1              CF=0;
  86   1              CCF0=0;
  87   1              CCF1=0;//’‚¡Ω∏ˆ±Í÷æŒªÀ‰»ª√ª”–”√µΩ
  88   1              CCF2=0;//µ´ «“‘∑¿ÕÚ“ª£¨µº÷¬÷–∂œø®◊°
  89   1      }
  90          
  91          /* ≥¨…˘≤®∑¢ÀÕ */
  92          void sand_ultrasonic()
  93          { 
  94   1              unsigned char i=0;
  95   1              //º∆ ±‘⁄«∞ªπ «∑¢ÀÕ‘⁄«∞∂ºø…“‘£¨‘⁄Œ“µƒ∞Â◊”…œŒ“∑¢œ÷º∆ ±‘⁄«∞µƒ ˝æ›±»Ωœ◊º»∑
  96   1              CH=0;
  97   1              CL=0;
  98   1              CF=0;
  99   1              
 100   1              EA=0;
 101   1              CR=1;
 102   1              for(i=0;i<8;i++)
 103   1              {
 104   2                      trig=1;Delay14us();
 105   2                      trig=0;Delay14us();
 106   2              }
 107   1              
 108   1              EA=1;
 109   1              
 110   1      }
 111          
 112          void calc_echo()
 113          {
 114   1              if(echo_flag==2)
 115   1              {
 116   2                      distance=(unsigned int)(CCAP0H<<8|CCAP0L)*0.017;//cm
C51 COMPILER V9.60.0.0   ECHO                                                              04/05/2025 13:11:54 PAGE 3   

 117   2              }
 118   1              else
 119   1              {
 120   2                      distance=0;
 121   2              }
 122   1      }
 123          
 124          void read_echo()
 125          {
 126   1              if(echo_flag>0)
 127   1              {
 128   2                      calc_echo();
 129   2                      echo_flag=0;
 130   2              }
 131   1              
 132   1              if(echo_flag==0)
 133   1              {
 134   2                      sand_ultrasonic();
 135   2                      echo_flag=1;
 136   2              }
 137   1      }
 138          
 139          ///* »Áπ˚ƒ„∑¢œ÷≤‚æ‡µƒ¡ø≥Ã∫‹∂Ã£¨ƒ«ƒ„”¶∏√ø¥ø¥
 140          //       œ¬‘ÿµƒ ±∫ÚIRC∆µ¬ ”–√ª”–µ˜≥…12.000MHz£¨
 141          //       ∂¯≤ª «¿¥÷ “…Œ“µƒ¥˙¬Î (>w<) */
 142          //void Delay13us()              //@12.000MHz
 143          //{
 144          //      unsigned char i;
 145          
 146          //      _nop_();
 147          //      _nop_();
 148          //      i = 39;
 149          //      while (--i);
 150          //}
 151          
 152          //void TimerPCAInit()
 153          //{
 154          //      CCON = 0;       //≥ı ºªØPCAøÿ÷∆ºƒ¥Ê∆˜
 155          //                                              //PCA∂® ±∆˜Õ£÷π
 156          //                                              //«Â≥˝CF±Í÷æ
 157          //                                              //«Â≥˝ƒ£øÈ÷–∂œ±Í÷æ
 158          //      CMOD = 0x01;            //…Ë÷√PCA ±÷”‘¥ 1MHz
 159          //                                                                      //ø™∆ÙPCA∂® ±∆˜“Á≥ˆ÷–∂œ
 160          //      CCAPM0 = 0x11;  //PCAƒ£øÈ0Œ™œ¬Ωµ—ÿ¥•∑¢
 161          //                                                                      //¿˚”√¬ˆ≥Â≤∂ªÒ¿¥ƒ£ƒ‚P11œ¬Ωµ—ÿÕ‚≤ø÷–∂œ
 162          //}
 163          
 164          ///* ultrasonic_flag ≥¨…˘≤®◊¥Ã¨±Í÷æ
 165          //       0£∫ø’œ–Ω◊∂Œ
 166          //       1£∫∑¢ÀÕΩ◊∂Œ
 167          //       2£∫»∑»œΩ” ’µΩ∑µªÿµƒ≥¨…˘≤®
 168          //       3£∫Ω” ’≤ªµΩ≥¨…˘≤®£¨ªÚ≥¨≥ˆ¡ø≥Ã */
 169          //unsigned char ultrasonic_flag = 0;
 170          
 171          
 172          ///* P11£¨º¥≥¨…˘≤®RX£¨“ªµ©≥ˆœ÷œ¬Ωµ—ÿ£¨
 173          //       ‘ÚÀµ√˜“—æ≠ ’µΩ∑µªÿµƒ≥¨…˘≤®£¨Ω¯»Î¥À÷–∂œ */
 174          //void TimerPCAIsr() interrupt 7
 175          //{
 176          //      CR = 0; //”≈œ»Ω· ¯º∆ ±
 177          //      
 178          //      if (ultrasonic_flag == 1) //µ±¥¶”⁄∑¢ÀÕΩ◊∂Œ
C51 COMPILER V9.60.0.0   ECHO                                                              04/05/2025 13:11:54 PAGE 4   

 179          //      {
 180          //              if (CCF0) /* Ω” ’µΩ∑µªÿµƒ≥¨…˘≤® */
 181          //                      ultrasonic_flag = 2; //»∑»œΩ” ’µΩ∑µªÿµƒ≥¨…˘≤®
 182          //              else if (CF) /* ≥¨≥ˆ¡ø≥Ã */
 183          //                      ultrasonic_flag = 3; //Ω” ’≤ªµΩ≥¨…˘≤®£¨ªÚ≥¨≥ˆ¡ø≥Ã
 184          //              else
 185          //                      ultrasonic_flag = 0; //“‚Õ‚«Èøˆ
 186          //      }
 187          ////    else ’‚¿Ô±æ”¶∏√º”’‚∏ˆelse£¨µ´”–bug£¨Œ“‘› ±’“≤ªµΩ
 188          ////            ultrasonic_flag = 0; //“‚Õ‚«Èøˆ
 189          //      
 190          //      CF = 0;
 191          //      CCF0 = 0;
 192          //      CCF1 = 0; //’‚¡Ω∏ˆ±Í÷æŒªÀ‰»ª√ª”–”√µΩ
 193          //      CCF2 = 0; //µ´ «“‘∑¿ÕÚ“ª£¨µº÷¬÷–∂œø®◊°
 194          //}
 195          
 196          ///* ≥¨…˘≤®∑¢ÀÕ */
 197          //void sand_ultrasonic()
 198          //{ //º∆ ±‘⁄«∞ªπ «∑¢ÀÕ‘⁄«∞∂ºø…“‘£¨‘⁄Œ“µƒ∞Â◊”…œŒ“∑¢œ÷º∆ ±‘⁄«∞µƒ ˝æ›±»Ωœ◊º»∑
 199          //      /* ∆Ù∂Øº∆ ± */
 200          //      CH = 0x8D;              //…Ë÷√∂® ±≥ı º÷µ£¨’‚∏ˆ÷µ «’‚√¥¿¥µƒ£∫0x8D1C °÷ 65535 - 500£®¿Â√◊£© / 0.017£®¿Â√◊/Œ¢√Î£©£¨œÎ∏
             -ƒ¡ø≥Ãø…“‘◊‘º∫À„
 201          //      CL = 0x1C;              //…Ë÷√∂® ±≥ı º÷µ
 202          //      /* æ≠π˝≤‚ ‘£¨∞Â◊”ƒ‹≤‚µƒ◊Ó≥§æ‡¿Î «4√◊£®÷¡…ŸŒ“’‚øÈ∞Â◊” «’‚—˘£©£¨
 203          //               ∂¯∂® ±∆˜µƒ¿Ì¬€¡ø≥Ã‘∂≥¨4√◊£¨À˘“‘…Ë÷√≥ı÷µµƒ“‚“Â‘⁄”⁄Àı∂Ã¡ø≥Ã
 204          //               £®¥Û∏≈ÀıºıµΩ5√◊£©£¨“‘¥À¿¥ºı…Ÿ≤ª±ÿ“™µƒ≤‚¡ø ±º‰£¨
 205          //               À˘“‘≥¨…˘≤®¥´≤•µƒ ±º‰æÕ «÷’÷µºı≥ı÷µ */
 206          //      CF = 0;         //«Â≥˝CF±Í÷æ
 207          //      
 208          //      /* ∆Ù∂Ø≥¨…˘≤®∑¢ÀÕ */
 209          //      EA = 0; //πÿ±’÷–∂œ£¨∑¿÷π¥Ú∂œ∑¢ÀÕ
 210          //      CR = 1; //∂® ±∆˜ø™ ºº∆ ±
 211          //      P10 = 1; Delay13us(); P10 = 0; Delay13us(); //∏ﬂµÁ∆Ω‘⁄«∞µÕµÁ∆Ω‘⁄∫Û
 212          //      P10 = 1; Delay13us(); P10 = 0; Delay13us();
 213          //      P10 = 1; Delay13us(); P10 = 0; Delay13us();
 214          //      P10 = 1; Delay13us(); P10 = 0; Delay13us();
 215          //      P10 = 1; Delay13us(); P10 = 0; Delay13us();
 216          //      P10 = 1; Delay13us(); P10 = 0; Delay13us();
 217          //      P10 = 1; Delay13us(); P10 = 0; Delay13us();
 218          //      P10 = 1; Delay13us(); P10 = 0; //”– ±∫Ú£¨◊ˆ»À“™÷±Ω”“ªµ„£®÷∏÷±Ω”∏¥÷∆8¥Œ£©
 219          //      EA = 1; //÷ÿ–¬¥Úø™÷–∂œ
 220          //}
 221          
 222          ///* º∆À„æ‡¿Î */
 223          //void calculate_distance()
 224          //{
 225          //      if (ultrasonic_flag == 2) //»∑»œΩ” ’µΩ∑µªÿµƒ≥¨…˘≤®
 226          //      {
 227          ////            distance = CCAP0H;
 228          ////            distance <<= 8;
 229          ////            distance |= CCAP0L;
 230          ////            distance -= 0x8D1C; //ºıµÙ∂® ±∆˜≥ı÷µ£¨ºı»•≥ı÷µ‘≠“Ú‘⁄…Ë÷√≥ı÷µµƒµÿ∑Ω”–◊¢Ω‚
 231          ////            distance = (float)distance * 0.017;
 232          //              distance = ((CCAP0H << 8 | CCAP0L) - 0x8D1C) * 0.017;
 233          //      }
 234          //      else //Ω” ’≤ªµΩ≥¨…˘≤®£¨ªÚ≥¨≥ˆ¡ø≥Ã
 235          //      {
 236          //              //distance = DISTANCE_OUTRANG;
 237          //              distance = 0;
 238          //      }
 239          //}
C51 COMPILER V9.60.0.0   ECHO                                                              04/05/2025 13:11:54 PAGE 5   

 240          
 241          ///* ∂¡»°æ‡¿Î∫Ø ˝
 242          //       ≤ª“ª∂®–Ë“™’‚√¥–¥
 243          //       ø…“‘∏¸æ›…œ√Ê¡Ω∏ˆ∫Ø ˝◊‘–––ﬁ∏ƒ */
 244          //void read_distance()
 245          //{ //ø…ƒ‹ƒ„ª·æıµ√’‚∏ˆ∫Ø ˝–¥µƒ≤ª∫√£¨µ´’‚”¶∏√ «◊ÓºÚµ•µƒ–¥∑®¡À
 246          //      if (ultrasonic_flag > 1)
 247          //      {
 248          //              calculate_distance();
 249          //              ultrasonic_flag = 0; //Ω¯»Î∑¢ÀÕΩ◊∂Œ
 250          //      }
 251          //      
 252          //      if (ultrasonic_flag == 0)
 253          //      {
 254          //              sand_ultrasonic();
 255          //              ultrasonic_flag = 1; //Ω¯»Î∑¢ÀÕΩ◊∂Œ
 256          //      }
 257          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    287    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      3    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
